ä¸»è¦æ˜¯å­¦ä¹ Swooleçš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹å¼

æ–‡æ¡£ï¼š
https://blog.csdn.net/william_n/article/details/127522690

ã€Œè¿™é‡Œçš„ç«¯å£ç»Ÿä¸€ä½¿ç”¨9501åšä¾‹å­ã€

1. ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨
Mac/Linux: æŸ¥çœ‹ç«¯å£æ˜¯å¦æ­£åœ¨ç›‘å¬
netstat -an | grep 9501

2. æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨çš„ç®€å•æ£€æµ‹æ‰‹æ®µ
åœ¨ Linux ä¸‹ï¼Œä½¿ç”¨ netstat -an | grep ç«¯å£ï¼ŒæŸ¥çœ‹ç«¯å£æ˜¯å¦å·²ç»è¢«æ‰“å¼€å¤„äº Listening çŠ¶æ€
ä¸Šä¸€æ­¥ç¡®è®¤åï¼Œå†æ£€æŸ¥é˜²ç«å¢™é—®é¢˜ã€‚
æ³¨æ„æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ IP åœ°å€ï¼Œå¦‚æœæ˜¯ 127.0.0.1 å›ç¯åœ°å€ï¼Œåˆ™å®¢æˆ·ç«¯åªèƒ½ä½¿ç”¨ 127.0.0.1 æ‰èƒ½è¿æ¥ä¸Š
ç”¨çš„é˜¿é‡Œäº‘æœåŠ¡æˆ–è€…è…¾è®¯æœåŠ¡ï¼Œéœ€è¦åœ¨å®‰å…¨æƒé™ç»„è¿›è¡Œè®¾ç½®å¼€å‘çš„ç«¯å£

3. ç¡®è®¤æ˜¯ç«¯å£å ç”¨ï¼ŒæŸ¥çœ‹ä»¥åŠkillå ç”¨ç«¯å£çš„ä¸»è¿›ç¨‹
æŸ¥çœ‹ç›‘å¬æŒ‡å®šç«¯å£çš„è¿›ç¨‹ï¼š
lsof -nP | grep LISTEN | grep 9501
ç»“æœå¦‚ä¸‹ï¼š
âœ  ~ lsof -nP | grep LISTEN | grep 9501
php       23702 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23703 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23708 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23709 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23711 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23712 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23713 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23714 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       23715 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       25403 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       25407 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       25409 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       25417 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
php       25430 huangbaoyin    5u     IPv4 0xc1779d015d613719         0t0                 TCP 127.0.0.1:9501 (LISTEN)
âœ  ~ 

æŸ¥çœ‹æ‰€æœ‰TCPè¿æ¥ç›‘å¬çŠ¶æ€çš„è¿›ç¨‹ï¼š
lsof -nP -iTCP -sTCP:LISTEN
æ‰§è¡Œå’Œç»“æœ
âœ  ~ lsof -nP -iTCP -sTCP:LISTEN
COMMAND     PID        USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
rapportd    432 huangbaoyin    3u  IPv4 0xc1779d01653496e1      0t0  TCP *:64811 (LISTEN)
rapportd    432 huangbaoyin    4u  IPv6 0xc1779d0af653b2d1      0t0  TCP *:64811 (LISTEN)
ControlCe   454 huangbaoyin   18u  IPv4 0xc1779d015cf256e1      0t0  TCP *:7000 (LISTEN)
ControlCe   454 huangbaoyin   19u  IPv6 0xc1779d0af653c7d1      0t0  TCP *:7000 (LISTEN)
ControlCe   454 huangbaoyin   20u  IPv4 0xc1779d015cf221e9      0t0  TCP *:5000 (LISTEN)
ControlCe   454 huangbaoyin   21u  IPv6 0xc1779d0af653ced1      0t0  TCP *:5000 (LISTEN)
com.docke  1707 huangbaoyin   29u  IPv4 0xc1779d015cf0f719      0t0  TCP *:51727 (LISTEN)
com.docke  1707 huangbaoyin   41u  IPv4 0xc1779d015cf22c81      0t0  TCP *:60086 (LISTEN)
com.docke  1707 huangbaoyin  151u  IPv4 0xc1779d015f64ec81      0t0  TCP 127.0.0.1:33060 (LISTEN)
com.docke  1707 huangbaoyin  152u  IPv4 0xc1779d015d5fac81      0t0  TCP 127.0.0.1:63790 (LISTEN)
com.docke  1707 huangbaoyin  235u  IPv4 0xc1779d015f7c21e9      0t0  TCP 127.0.0.1:4430 (LISTEN)
com.docke  1707 huangbaoyin  237u  IPv4 0xc1779d01631e3719      0t0  TCP 127.0.0.1:8080 (LISTEN)
vpnkit-br 16738 huangbaoyin    8u  IPv4 0xc1779d015cf22c81      0t0  TCP *:60086 (LISTEN)
php       23702 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23703 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23708 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23709 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23711 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23712 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23713 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23714 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       23715 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       25403 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       25407 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       25409 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       25417 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
php       25430 huangbaoyin    5u  IPv4 0xc1779d015d613719      0t0  TCP 127.0.0.1:9501 (LISTEN)
?\x81?  55673 huangbaoyin  233u  IPv4 0xc1779d0161b6b719      0t0  TCP 127.0.0.1:50010 (LISTEN)
?\x81?  55673 huangbaoyin  334u  IPv4 0xc1779d01600da1e9      0t0  TCP 192.168.2.10:5786 (LISTEN)
ClashX    90474 huangbaoyin    7u  IPv4 0xc1779d015ea2e1e9      0t0  TCP 127.0.0.1:7890 (LISTEN)
ClashX    90474 huangbaoyin    8u  IPv4 0xc1779d015e927719      0t0  TCP 127.0.0.1:9090 (LISTEN)
âœ  ~ 

Mac: æŸ¥çœ‹æ‰§è¡Œçš„è¿›ç¨‹ã€Œç‰¹åˆ«æ˜¯å¯åŠ¨Swooleè„šæœ¬çš„è¿›ç¨‹ã€
ps -ef | grep 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php 

æ‰§è¡Œå’Œè¾“å‡ºï¼š
âœ  learning_of_swoole git:(main) âœ— ps -ef | grep 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23702     1   0  4:44ä¸‹åˆ ??         0:00.11 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23703 23702   0  4:44ä¸‹åˆ ??         0:00.02 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23708 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23709 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23711 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23712 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23713 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23714 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 23715 23703   0  4:44ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 25403 23703   0  4:55ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 25407 23703   0  4:55ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 25409 23703   0  4:55ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 25417 23703   0  4:55ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 25430 23703   0  4:56ä¸‹åˆ ??         0:00.00 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
  501 26811 25496   0  5:06ä¸‹åˆ ttys001    0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
âœ  learning_of_swoole git:(main) âœ— 

ä»ä¸Šé¢çš„ç»“æœå¯åˆ†æå¾—åˆ°ï¼š
è¿›ç¨‹æ ‘ã€Œè¿›ç¨‹æ¨¡å‹ã€

å¯ä»¥ä½¿ç”¨pstreeå·¥å…·åˆ†æä½œè¯
âœ  learning_of_swoole git:(main) âœ— pstree -p 23702 // 23702 å³swooleçš„ä¸»ã€Œç¥–å®—ã€è¿›ç¨‹
-+= 00001 root /sbin/launchd
 \-+= 23702 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
   \-+- 23703 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23708 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23709 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23711 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23712 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23713 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23714 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 23715 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 25403 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 25407 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 25409 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     |--- 25417 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
     \--- 25430 huangbaoyin php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php
âœ  learning_of_swoole git:(main) âœ— 
Swooleè¿›ç¨‹æ¨¡å‹ï¼š
-+= 00001 // æ“ä½œç³»ç»ŸçœŸæ­£çš„ç¥–å®—è¿›ç¨‹
 \-+= 23702 // Swooleçš„ä¸»è¿›ç¨‹ï¼Œç¥–å®—è¿›ç¨‹
   \-+- 23703 // Managerè¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹ä¸º23702ï¼Œä¸‹é¢çš„è¿›ç¨‹éƒ½æ˜¯å®ƒçš„å­è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°12ä¸ªï¼Œ8{workerè¿›ç¨‹}+4{taskè¿›ç¨‹}
     |--- 23708 
     |--- 23709 
     |--- 23711 
     |--- 23712 
     |--- 23713 
     |--- 23714 
     |--- 23715 
     |--- 25403 
     |--- 25407 
     |--- 25409 
     |--- 25417 
     \--- 25430 


Macä¸Šå¯èƒ½æ²¡å®‰è£…ï¼Œéœ€è¦è‡ªå·±å®‰è£…ä¸‹
âœ  ~ brew info pstree   // æŸ¥çœ‹ä¸‹ä¿¡æ¯
==> pstree: stable 2.39 (bottled)
Show ps output as a tree
http://www.thp.uni-duisburg.de/pstree/
Not installed
From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/pstree.rb
==> Analytics
install: 15,678 (30 days), 35,771 (90 days), 67,813 (365 days)
install-on-request: 15,665 (30 days), 35,755 (90 days), 67,790 (365 days)
build-error: 0 (30 days)
âœ  ~ export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890
âœ  ~ 

ä½¿ç”¨
brew install pstreeå®‰è£…
æˆ–è€…
ä¸‹è½½æºç ï¼Œè¿›è¡Œç¼–è¯‘å®‰è£…
https://mirrors.ustc.edu.cn/homebrew-bottles/pstree-2.39.arm64_monterey.bottle.2.tar.gz
or
https://ghcr.io/v2/homebrew/core/pstree/manifests/2.39-2

è¿™é‡Œä½¿ç”¨brewè¿›è¡Œå®‰è£…
âœ  ~ brew install pstree
Running `brew update --auto-update`...
==> Auto-updated Homebrew!
Updated 1 tap (shivammathur/php).

==> Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/pstree-2.39.arm64_monterey.bottle.2.tar.gz
curl: (22) The requested URL returned error: 404                              

Warning: Bottle missing, falling back to the default domain...
==> Downloading https://ghcr.io/v2/homebrew/core/pstree/manifests/2.39-2
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/pstree/blobs/sha256:9733dc8a9d384a122e5fad0b21a33142bef94cf85e2a0cb02e66753fd316a133
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:9733dc8a9d384a122e5fad0b21a33142bef94cf85e2a0cb02e66753fd316a133?se=2022-10-29T09%3A25%3A00Z&sig=RSyyUp6gk%2B51Z6QhRd
######################################################################## 100.0%
==> Pouring pstree--2.39.arm64_monterey.bottle.2.tar.gz
ğŸº  /opt/homebrew/Cellar/pstree/2.39: 5 files, 57.5KB
==> Running `brew cleanup pstree`...
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).
âœ  ~

4. æ€æ­»è¿›ç¨‹
é€šå¸¸ä½¿ç”¨killå³å¯

è¿™é‡Œæ€æ­»Swooleä¸»è¿›ç¨‹ï¼Œä½†æ˜¯é‡åˆ°äº†é—®é¢˜ï¼Œmanagerå’Œworker/taskè¿›ç¨‹ä¾ç„¶å­˜åœ¨
âœ  learning_of_swoole git:(main) âœ— kill -9 23702
âœ  learning_of_swoole git:(main) âœ— pstree -p 23702
âœ  learning_of_swoole git:(main) âœ— 

è§£å†³åŠæ³•ï¼š
æ–¹å¼ä¸€ï¼šä½¿ç”¨killall // å¥½å¤„ï¼Œä¸è®ºæ˜¯å¦å·²kill masterè¿›ç¨‹
killall -9 php 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.php // æ‰€æœ‰ã€Œphp 2-å¿«é€Ÿå¯åŠ¨/server/tcp_server_with_async_task.phpã€è¿›ç¨‹åçš„è¿›ç¨‹

æ–¹å¼äºŒï¼š å¦‚æœè¿˜æ²¡æœ‰kill masterè¿›ç¨‹ã€Œæˆ–è€…è¯´åªè¦è¿™äº›è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ä¸æ˜¯PID=1çš„è¿›ç¨‹å°±å¯ä»¥ã€
kill -15 çˆ¶è¿›ç¨‹

æ–¹å¼ä¸‰: ä¸€ä¸ªä¸€ä¸ªkill
